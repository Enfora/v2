import os
import asyncio
import aiohttp

def clear_console():
    os.system("cls")

async def basic_get(url):
    async with aiohttp.ClientSession() as session:
        while True:
            try:
                async with session.get(url, timeout=2) as response:
                    
                    # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                    if response.status != 200:
                        print(f"‚ùå –û—à–∏–±–∫–∞ HTTP: {response.status} - {response.reason}")
                        await asyncio.sleep(1)
                        continue
                    
                    # ‚úÖ –ü–æ–ª—É—á–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    data = await response.text()
                    listData = data.strip().split("\n")
                    
                    # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ
                    if not listData or not listData[0].strip():
                        print("‚ö†Ô∏è –ü–æ–ª—É—á–µ–Ω—ã –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤–µ—Å–æ–≤")
                        await asyncio.sleep(0.2)
                        continue
                    
                    # ‚úÖ –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                    weight_value = float(listData[0])
                    weight_value = weight_value if weight_value >= 0 else 0   #–¢–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä
                    print(f"‚úÖ –í–µ—Å: {weight_value:.3f} –∫–≥")
                    
            except asyncio.TimeoutError:
                print("‚è∞ –¢–∞–π–º–∞—É—Ç: –í–µ—Å—ã –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã")
            except aiohttp.ClientError as e:
                print(f"üåê –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: {e}")
            except ValueError as e:
                print(f"üî¢ –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –Ω–µ –º–æ–≥—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å '{listData[0]}' –≤ —á–∏—Å–ª–æ")
            except IndexError:
                print("üìã –û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ")
            except Exception as e:
                print(f"‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
            
            # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
            await asyncio.sleep(0.012)

if __name__ == "__main__":
    clear_console()
    
    ip_address = "192.168.77.29"
    url = f"http://{ip_address}/rawdata.html"

    print("üöÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤–µ—Å–æ–≤")
    print("üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫:", url)
    print("‚èπÔ∏è  –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏\n")
    
    try:
        asyncio.run(basic_get(url))
    except KeyboardInterrupt:
        print("\nüëã –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")